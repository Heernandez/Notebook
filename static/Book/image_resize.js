/* esm.sh - tiptap-extension-resize-image@1.3.2 */
import m from"https://esm.sh/@tiptap/extension-image@3.10.7?target=es2022";var r={MOBILE_BREAKPOINT:768,ICON_SIZE:"24px",CONTROLLER_HEIGHT:"25px",DOT_SIZE:{MOBILE:16,DESKTOP:9},DOT_POSITION:{MOBILE:"-8px",DESKTOP:"-4px"},COLORS:{BORDER:"#6C6C6C",BACKGROUND:"rgba(255, 255, 255, 1)"},ICONS:{LEFT:"https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_left/default/20px.svg",CENTER:"https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_center/default/20px.svg",RIGHT:"https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_right/default/20px.svg"}},a={isMobile(){return document.documentElement.clientWidth<r.MOBILE_BREAKPOINT},getDotPosition(){return a.isMobile()?r.DOT_POSITION.MOBILE:r.DOT_POSITION.DESKTOP},getDotSize(){return a.isMobile()?r.DOT_SIZE.MOBILE:r.DOT_SIZE.DESKTOP},clearContainerBorder(n){let t=n.getAttribute("style"),e=t?.replace("border: 1px dashed #6C6C6C;","").replace("border: 1px dashed rgb(108, 108, 108)","");n.setAttribute("style",e)},removeResizeElements(n){if(n.childElementCount>3)for(let t=0;t<5;t++)n.removeChild(n.lastChild)}},c=class{static getContainerStyle(t,e){return`${`width: ${e||"100%"}; height: auto; cursor: pointer;`} ${t?"display: inline-block;":""}`}static getWrapperStyle(t){return t?"display: inline-block; float: left; padding-right: 8px;":"display: flex"}static getPositionControllerStyle(t){return`
      position: absolute; 
      top: 0%; 
      left: 50%; 
      width: ${t?"66px":"100px"}; 
      height: ${r.CONTROLLER_HEIGHT}; 
      z-index: 999; 
      background-color: ${r.COLORS.BACKGROUND}; 
      border-radius: 3px; 
      border: 1px solid ${r.COLORS.BORDER}; 
      cursor: pointer; 
      transform: translate(-50%, -50%); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 0 6px;
    `.replace(/\s+/g," ").trim()}static getDotStyle(t){let e=a.getDotPosition(),s=a.getDotSize(),i=[`top: ${e}; left: ${e}; cursor: nwse-resize;`,`top: ${e}; right: ${e}; cursor: nesw-resize;`,`bottom: ${e}; left: ${e}; cursor: nesw-resize;`,`bottom: ${e}; right: ${e}; cursor: nwse-resize;`];return`
      position: absolute; 
      width: ${s}px; 
      height: ${s}px; 
      border: 1.5px solid ${r.COLORS.BORDER}; 
      border-radius: 50%; 
      ${i[t]}
    `.replace(/\s+/g," ").trim()}},h=class{static parseImageAttributes(t,e){Object.entries(t).forEach(([s,i])=>{if(!(i==null||s==="wrapperStyle")){if(s==="containerStyle"){let o=i.match(/width:\s*([0-9.]+)px/);o&&e.setAttribute("width",o[1]);return}e.setAttribute(s,i)}})}static extractWidthFromStyle(t){let e=t.match(/width:\s*([0-9.]+)px/);return e?e[1]:null}},d=class{constructor(t,e,s){this.elements=t,this.inline=e,this.dispatchNodeView=s}createControllerIcon(t){let e=document.createElement("img");return e.setAttribute("src",t),e.setAttribute("style",`width: ${r.ICON_SIZE}; height: ${r.ICON_SIZE}; cursor: pointer;`),e.addEventListener("mouseover",s=>{s.target.style.opacity="0.6"}),e.addEventListener("mouseout",s=>{s.target.style.opacity="1"}),e}handleLeftClick(){if(!this.inline)this.elements.container.setAttribute("style",`${this.elements.container.style.cssText} margin: 0 auto 0 0;`);else{let t="display: inline-block; float: left; padding-right: 8px;";this.elements.wrapper.setAttribute("style",t),this.elements.container.setAttribute("style",t)}this.dispatchNodeView()}handleCenterClick(){this.elements.container.setAttribute("style",`${this.elements.container.style.cssText} margin: 0 auto;`),this.dispatchNodeView()}handleRightClick(){if(!this.inline)this.elements.container.setAttribute("style",`${this.elements.container.style.cssText} margin: 0 0 0 auto;`);else{let t="display: inline-block; float: right; padding-left: 8px;";this.elements.wrapper.setAttribute("style",t),this.elements.container.setAttribute("style",t)}this.dispatchNodeView()}createPositionControls(){let t=document.createElement("div");t.setAttribute("style",c.getPositionControllerStyle(this.inline));let e=this.createControllerIcon(r.ICONS.LEFT);if(e.addEventListener("click",()=>this.handleLeftClick()),t.appendChild(e),!this.inline){let i=this.createControllerIcon(r.ICONS.CENTER);i.addEventListener("click",()=>this.handleCenterClick()),t.appendChild(i)}let s=this.createControllerIcon(r.ICONS.RIGHT);return s.addEventListener("click",()=>this.handleRightClick()),t.appendChild(s),this.elements.container.appendChild(t),this}},u=class{constructor(t,e){this.state={isResizing:!1,startX:0,startY:0,startWidth:0,startHeight:0,maxWidth:null},this.getMaxWidth=()=>{var s=this.elements.wrapper.closest(".ProseMirror")||this.elements.wrapper.closest(".editor-surface");return s?Math.max(20,s.clientWidth):null},this.handleMouseMove=(s,i)=>{if(!this.state.isResizing)return;let o=s.clientX-this.state.startX,l=s.clientY-this.state.startY,p=i%2===0?this.state.startWidth-o:this.state.startWidth+o,g=i<2?this.state.startHeight-l:this.state.startHeight+l;p=Math.max(20,p),g=Math.max(20,g),this.state.maxWidth&&(p=Math.min(p,this.state.maxWidth)),this.elements.container.style.width=p+"px",this.elements.container.style.height=g+"px",this.elements.img.style.width=p+"px",this.elements.img.style.height=g+"px"},this.handleMouseUp=()=>{this.state.isResizing&&(this.state.isResizing=!1),this.dispatchNodeView()},this.handleTouchMove=(s,i)=>{if(!this.state.isResizing)return;let o=s.touches[0].clientX-this.state.startX,l=s.touches[0].clientY-this.state.startY,p=i%2===0?this.state.startWidth-o:this.state.startWidth+o,g=i<2?this.state.startHeight-l:this.state.startHeight+l;p=Math.max(20,p),g=Math.max(20,g),this.state.maxWidth&&(p=Math.min(p,this.state.maxWidth)),this.elements.container.style.width=p+"px",this.elements.container.style.height=g+"px",this.elements.img.style.width=p+"px",this.elements.img.style.height=g+"px"},this.handleTouchEnd=()=>{this.state.isResizing&&(this.state.isResizing=!1),this.dispatchNodeView()},this.elements=t,this.dispatchNodeView=e}createResizeHandle(t){let e=document.createElement("div");return e.setAttribute("style",c.getDotStyle(t)),e.addEventListener("mousedown",s=>{s.preventDefault(),this.state.isResizing=!0,this.state.startX=s.clientX,this.state.startY=s.clientY,this.state.startWidth=this.elements.container.offsetWidth,this.state.startHeight=this.elements.container.offsetHeight,this.state.maxWidth=this.getMaxWidth();let i=l=>this.handleMouseMove(l,t),o=()=>{this.handleMouseUp(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)}),e.addEventListener("touchstart",s=>{s.cancelable&&s.preventDefault(),this.state.isResizing=!0,this.state.startX=s.touches[0].clientX,this.state.startY=s.touches[0].clientY,this.state.startWidth=this.elements.container.offsetWidth,this.state.startHeight=this.elements.container.offsetHeight,this.state.maxWidth=this.getMaxWidth();let i=l=>this.handleTouchMove(l,t),o=()=>{this.handleTouchEnd(),document.removeEventListener("touchmove",i),document.removeEventListener("touchend",o)};document.addEventListener("touchmove",i),document.addEventListener("touchend",o)},{passive:!1}),e}},p=class{constructor(t,e){this.clearContainerBorder=()=>{a.clearContainerBorder(this.elements.container)},this.dispatchNodeView=()=>{var s;let{view:i,getPos:o}=this.context;if(typeof o=="function"){this.clearContainerBorder();let l=Object.assign(Object.assign({},this.context.node.attrs),{width:(s=h.extractWidthFromStyle(this.elements.container.style.cssText))!==null&&s!==void 0?s:this.context.node.attrs.width,containerStyle:`${this.elements.container.style.cssText}`,wrapperStyle:`${this.elements.wrapper.style.cssText}`});i.dispatch(i.state.tr.setNodeMarkup(o(),null,l))}},this.removeResizeElements=()=>{a.removeResizeElements(this.elements.container)},this.context=t,this.inline=e,this.elements=this.createElements()}createElements(){return{wrapper:document.createElement("div"),container:document.createElement("div"),img:document.createElement("img")}}setupImageAttributes(){h.parseImageAttributes(this.context.node.attrs,this.elements.img)}setupDOMStructure(){let{wrapperStyle:t,containerStyle:e}=this.context.node.attrs;this.elements.wrapper.setAttribute("style",t),this.elements.wrapper.appendChild(this.elements.container),this.elements.container.setAttribute("style",e),this.elements.container.appendChild(this.elements.img)}createPositionController(){new d(this.elements,this.inline,this.dispatchNodeView).createPositionControls()}createResizeHandler(){let t=new u(this.elements,this.dispatchNodeView);Array.from({length:4},(e,s)=>{let i=t.createResizeHandle(s);this.elements.container.appendChild(i)})}setupContainerClick(){this.elements.container.addEventListener("click",()=>{var t;a.isMobile()&&((t=document.querySelector(".ProseMirror-focused"))===null||t===void 0||t.blur()),this.removeResizeElements(),this.createPositionController(),this.elements.container.setAttribute("style",`position: relative; border: 1px dashed ${r.COLORS.BORDER}; ${this.context.node.attrs.containerStyle}`),this.createResizeHandler()})}setupContentClick(){document.addEventListener("click",t=>{let e=t.target;this.elements.container.contains(e)||e.style.cssText===`width: ${r.ICON_SIZE}; height: ${r.ICON_SIZE}; cursor: pointer;`||(this.clearContainerBorder(),this.removeResizeElements())})}initialize(){this.setupDOMStructure(),this.setupImageAttributes();let{editable:t}=this.context.editor.options;return t?(this.setupContainerClick(),this.setupContentClick(),{dom:this.elements.wrapper}):{dom:this.elements.container}}},C=m.extend({name:"imageResize",addOptions(){var n;return Object.assign(Object.assign({},(n=this.parent)===null||n===void 0?void 0:n.call(this)),{inline:!1})},addAttributes(){var n;let t=this.options.inline;return Object.assign(Object.assign({},(n=this.parent)===null||n===void 0?void 0:n.call(this)),{containerStyle:{default:null,parseHTML:e=>{let s=e.getAttribute("containerstyle");if(s)return s;let i=e.getAttribute("width");return i?c.getContainerStyle(t,`${i}px`):`${e.style.cssText}`}},wrapperStyle:{default:c.getWrapperStyle(t)}})},addNodeView(){return({node:n,editor:t,getPos:e})=>{let s=this.options.inline,i={node:n,editor:t,view:t.view,getPos:typeof e=="function"?e:void 0};return new p(i,s).initialize()}}});export{C as ImageResize,C as default};
//# sourceMappingURL=tiptap-extension-resize-image.mjs.map
