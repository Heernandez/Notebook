{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Note-Book{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'Book/base.css' %}" />
  </head>
  <body class="{% block body_class %}{% endblock %}">
    {% block header %}
      <header class="topbar">
        <div class="topbar-row">
          <div class="topbar-left">
          <button class="icon-btn" type="button" aria-label="Profile" data-profile-toggle>
            <span class="icon-circle"></span>
          </button>
            <!--
            <a class="brand" href="#">
              <span class="brand-mark"></span>
              <span>Note-Book</span>
            </a>
            -->
          </div>
          <form class="header-search" method="get" action="{{ request.path }}">
            <input type="search" name="q" placeholder="Search books, creators, themes" value="{{ request.GET.q|default:"" }}" />
            <button type="submit" aria-label="Search">
              <span class="search-text">Search</span>
              <span class="search-icon" aria-hidden="true"></span>
            </button>
          </form>
          {% if user.is_authenticated %}
            <button class="icon-btn" type="button" aria-label="Notifications">
              <span class="icon-bell"></span>
            </button>
          {% endif %}
        </div>
      </header>
    {% endblock %}

    <main class="{% block main_class %}{% endblock %}">
      {% block toolbar %}
        <div class="body-toolbar">
          <form
            class="category-filter"
            method="get"
            action="{% if request.resolver_match and request.resolver_match.url_name == 'my_list' %}{% url 'Book:my_list' %}{% else %}{% url 'Book:public_list' %}{% endif %}"
            data-category-filter
          >
            <label class="category-select">
              <span>Category</span>
              <select name="category">
                <option value="">All</option>
                {% for category in categories %}
                  <option
                    value="{{ category.pk }}"
                    {% if request.GET.category == category.pk|stringformat:"s" %}selected{% endif %}
                  >
                    {{ category.name }}
                  </option>
                {% endfor %}
              </select>
            </label>
          </form>
          {% if request.resolver_match and request.resolver_match.url_name == "my_list" %}
            <a class="library-btn" href="{% url 'Book:public_list' %}">Library</a>
          {% else %}
            <a class="library-btn" href="{% url 'Book:my_list' %}">My Library</a>
          {% endif %}
        </div>
      {% endblock %}
      {% block content %}{% endblock %}
    </main>
    <div class="profile-menu" data-profile-menu>
      {% if user.is_authenticated %}
        <div class="profile-header">
          <span class="profile-avatar"></span>
          <span class="profile-name">{{ user.first_name }} {{ user.last_name }}</span>
        </div>
        <a href="#">My profile</a>
        <a href="{% url 'Book:my_list' %}">My Library</a>
        <a href="{% url 'Book:create' %}">New Book</a>
        <div class="profile-divider"></div>
        <form method="post" action="/accounts/logout/?next={% url 'Book:public_list' %}">
          {% csrf_token %}
          <button type="submit">Log out</button>
        </form>
      {% else %}
        <a href="{% url 'Book:create' %}">New Book</a>
        <a href="/accounts/login/">Sign in</a>
        <a href="{% url 'User:signup' %}">Sign up</a>
      {% endif %}
    </div>
    <script>
      (function () {
        var toggle = document.querySelector("[data-profile-toggle]");
        var menu = document.querySelector("[data-profile-menu]");
        if (!toggle || !menu) return;

        function closeMenu() {
          menu.classList.remove("is-open");
        }

        toggle.addEventListener("click", function (event) {
          event.stopPropagation();
          menu.classList.toggle("is-open");
        });

        document.addEventListener("click", function (event) {
          if (!menu.contains(event.target)) {
            closeMenu();
          }
        });
      })();
      (function () {
        var filterForm = document.querySelector("[data-category-filter]");
        if (!filterForm) return;
        var select = filterForm.querySelector("select[name='category']");
        if (!select) return;
        select.addEventListener("change", function () {
          filterForm.submit();
        });
      })();
    </script>
    {% block footer %}
      <footer class="footer">
        <div class="footer-inner">
          <span>Note-Book Â· Living stories in public</span>
          <div class="footer-links">
            <a href="#">Privacy</a>
            <a href="#">Terms</a>
            <a href="#">Contact</a>
          </div>
        </div>
      </footer>
    {% endblock %}
  </body>
</html>
