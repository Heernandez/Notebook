{% extends "Book/base.html" %}
{% load static %}

{% block title %}Book · Note-Book{% endblock %}

{% block content %}
  <a class="reader-back" href="{% url 'Book:public_list' %}" aria-label="Back">←</a>
  <section class="detail-layout">
    <div class="detail-cover">
      {% if book.cover_image %}
        <img src="{{ book.cover_image.url }}" alt="Cover for {{ book.title }}" />
      {% else %}
        <div class="cover-placeholder">No cover</div>
      {% endif %}
    </div>
    <div class="detail-info">
      <h1 class="detail-title">{{ book.title }}</h1>
      <h3 class="detail-author">{{ book.owner.first_name }} {{ book.owner.last_name }}</h3>
      <span class="detail-date">{{ book.created_at|date:"M Y" }}</span>
    </div>
  </section>
  <div class="detail-actions-row">
    <div class="detail-rating">
      <span class="detail-rating-top">
        <span class="rating-star" aria-hidden="true"></span>
        <span class="rating-value">4.6</span>
      </span>
      <span class="detail-rating-bottom">120 reviews</span>
    </div>
    <span class="detail-sep" aria-hidden="true">|</span>
    <button class="save-btn" type="button" aria-label="Save book">
      <img
        src="{% static 'Book/unsaved.png' %}"
        alt=""
        aria-hidden="true"
        data-unsaved-src="{% static 'Book/unsaved.png' %}"
        data-saved-src="{% static 'Book/saved.png' %}"
      />
    </button>
    <span class="detail-sep" aria-hidden="true">|</span>
    <a class="save-btn detail-read" href="{% url 'Book:reader' book.pk %}" aria-label="Read">
      <img src="{% static 'Book/read.png' %}" alt="" aria-hidden="true" />
    </a>
    <span class="detail-sep" aria-hidden="true">|</span>
    <span class="detail-pages">
      <span class="detail-pages-count">{{ leaves|length }}</span>
      <span class="detail-pages-label">page{% if leaves|length != 1 %}s{% endif %}</span>
    </span>
    {% if user == book.owner %}
      <a class="save-btn detail-add" href="{% url 'Book:add_leaf' book.pk %}">Add leaf</a>
    {% endif %}
  </div>
  <section class="detail-about">
    <h2>About this notebook</h2>
    <p>{{ book.description|default:"No description yet" }}</p>
  </section>
  <script>
    (function () {
      var btn = document.querySelector(".save-btn");
      if (!btn) return;
      var img = btn.querySelector("img");
      if (!img) return;
      var saved = false;
      btn.addEventListener("click", function () {
        saved = !saved;
        img.src = saved ? img.dataset.savedSrc : img.dataset.unsavedSrc;
      });
    })();
  </script>
{% endblock %}
{% block toolbar %}{% endblock %}
